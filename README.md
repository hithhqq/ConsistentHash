### 一致性哈希

#### 为什么需要一致性哈希

对于有状态服务，倘若存在纵向分治策略，那么我们就需要维护好状态数据与所从属之间的映射关系，一旦集群发生扩容，节点数量发生变更，对应的映射关系就需要发生变化，对应的状态就要发生转移，这会是一个很复杂且笨重的流程，而一致性哈希的核心价值就是为了有效降低有状态服务集群扩缩容流程的数据迁移成本

#### 一致性哈希算法原理

- 一致性哈希算法是一种适用于有状态服务集群的负载均衡策略
- 一致性哈希算法数据结构有一个首位衔接的哈希环组成
- 节点入环时，通过取哈希并对环长度取模，确定节点所在的位置
- 数据入环时，通过取哈希并对环长度取模，然后找到顺时针往下的第一个节点，作为命中的目标节点
- 一致性哈希算法最大的优势时，在集群节点数量发生变更时，只需要承担局部小范围的数据迁移成本

#### 虚拟节点

哈希散列本身是具有离散性的，节点数据分配不均的问题通常只会发生在集群节点数量较少的情况下，那么，倘若我们采用某种手段，将节点数量放大，那么更大的数据严格不能就自然而然地能够弥合或缩小这部分误差所产生的影响，进一步凸显出哈希函数的离散性质。